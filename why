#include <iostream>
#include "lotto.h"
#include <ctime>
#include <cstdlib>
#define highest 45

using namespace std;

void Lotto::generate_lotto() {
    srand((unsigned)time(NULL));

    for (int i = 0; i < 6; i++) {
        bool count = false;

        do {
            lotto[i] = rand() % highest + 1;  // 1부터 45까지의 랜덤 번호 생성

            // 중복 체크
            for (int j = 0; j < i; j++) {
                if (lotto[j] == lotto[i]) { 
                    count = true; //중복이면 카운트가 트루 (do while 무한 반복을 돌게 하기 위해)
                    break;  // 중복이 있으면 더 이상 확인할 필요 없음
                }
            }
        } while (count); 
    }
}

void Lotto::receive_lotto() {

    bool n = false;

    cout << "숫자 6개를 중복 없이 입력하시오." << endl;

    for (int i = 0; i < 6; i++) {
        do {
            do {
                cout << i + 1 << "번 째 숫자: ";
                cin >> this->user[i];
                if (this->user[i] < 1 || this->user[i] >highest) {
                    cout << "1~45 입력" << endl;
                }
            } while (this->user[i] < 1 || this->user[i] >highest); //입력받은 값이 1~45 가 아니면 do while 반복

                for(int j=0; j<i; j++ ) {
                    if (this->user[j] == this->user[i]) { //해당 인덱스에서 입력 받은 값과 이전 인덱스에 입력받은 값 비교
                        cout << "중복된 숫자가 있습니다" << endl;
                        n = true;           //같은 숫자가 있으면 n을 트루로 만들고 브레이크 (해당인덱스에 값을 입력하는 do while 문으로 돌아감)
                        break;
                    }
                    else {
                        n = false;
                    }
                }
        } while (n);
    }  
}

void Lotto::print_Lotto() {
    cout << endl;

    cout << "로또번호: ";
    for (int i = 0; i < 6; i++) {
        cout << this->lotto[i] << ' ';
    }

    cout << endl;

    cout << "입력한 번호: ";
    for (int i = 0; i < 6; i++) {
        cout << this->user[i] << ' ';
    }

    cout << '\n' << endl;
}

void Lotto::Lotto_rank() {
    int count = 0;

    for (int i = 0; i < 6; i++) {
        for (int j = 0; j < 6; j++) {
            if (this->user[i] == this->lotto[j]) { //user[i]에 있는 숫자를 lotto[]배열에 있는 모든 숫자와 비교하여 같은 숫자 있는지 체크
                count++;
            }
        }
    }

    if (count >= 3) {
        cout << "1등! 100만원 받으세요" << endl;
    }
    else if (count == 2) {
        cout << "2등! 50만원 받으세요" << endl;
    }
    else if (count == 1) {
        cout << "3등! 1만원 받으세요" << endl;                   
    }
    else {
        cout << "아쉽지만 다음에 다시 이용해주세요" << endl;
    }
};

void Lotto::start() {
    generate_lotto(); //로또 배열에 랜덤함수 발생
    receive_lotto(); // 사용자에게서 번호를 입력받는 함수
    print_Lotto(); // 로또번호와 입력받은 번호 출력
    Lotto_rank(); //로또 순위 출력 함수
};
